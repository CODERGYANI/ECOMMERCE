<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Cart</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #f4f6f8;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 30px;
  }

  .cart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }

  .cart-card {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform 0.2s;
  }
  .cart-card:hover {
    transform: translateY(-5px);
  }

  .cart-image {
    width: 100%;
    height: 180px;
    object-fit: cover;
    background-color: #e5e7eb;
  }
  .cart-image.fallback {
    display: grid;
    place-items: center;
    color: #6b7280;
    font-weight: 600;
  }

  .cart-details {
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    flex-grow: 1;
  }

  .cart-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 4px;
    color: #111827;
  }

  .cart-style {
    font-size: 13px;
    color: #6b7280;
  }

  .price-row {
    display: flex;
    gap: 10px;
    align-items: baseline;
  }
  .price {
    font-size: 16px;
    font-weight: 600;
    color: #111827;
  }
  .discounted {
    font-size: 14px;
    color: #ef4444;
    text-decoration: line-through;
  }
  .total-price {
    font-weight: 700;
    color: #2563eb;
  }

  .action-bar {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    gap: 6px;
  }
  .action-bar a, .action-bar form button {
    flex: 1;
    padding: 8px 10px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
    text-decoration: none;
  }
  .view-btn {
    background-color: #f3f4f6;
    color: #111827;
    border: 1px solid #d1d5db;
  }
  .view-btn:hover { background-color: #e5e7eb; transform: translateY(-1px); }

  .buy-btn {
    background-color: #2563eb;
    color: #fff;
    border: none;
  }
  .buy-btn:hover { background-color: #1e40af; transform: translateY(-1px); }

  .remove-btn {
    background-color: #ef4444;
    color: #fff;
    border: none;
  }
  .remove-btn:hover { background-color: #b91c1c; transform: translateY(-1px); }

</style>
</head>
<body>
<h1>My Cart</h1>

<div class="cart-grid">
  <% if (products && products.length > 0) { %>
    <% products.forEach(product => { %>
      <div class="cart-card">
        <% if (product.image) { %>
          <img class="cart-image" src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="<%= product.name %>">
        <% } else { %>
          <div class="cart-image fallback">No Image</div>
        <% } %>

        <div class="cart-details">
          <div class="cart-name"><%= product.name %></div>
          <% if (product.styleinfo) { %>
            <div class="cart-style"><%= product.styleinfo %></div>
          <% } %>

          <div class="price-row">
            <% if (product.discount && product.discount > 0) { %>
              <span class="price"><%= product.price - product.discount %> ₹</span>
              <span class="discounted"><%= product.price %> ₹</span>
            <% } else { %>
              <span class="price"><%= product.price %> ₹</span>
            <% } %>
          </div>
          <div class="total-price">
            Total: <%= product.discount ? (product.price - product.discount) : product.price %> ₹
          </div>

          <div class="action-bar">
            <a href="/product/<%= product._id %>" class="view-btn">View More</a>
            <a href="/checkout/<%= product._id %>" class="buy-btn">Buy Now</a>
            <form method="POST" action="/users/cart/remove/<%= product._id %>">
              <button type="submit" class="remove-btn">Remove</button>
            </form>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <p style="grid-column: 1/-1; text-align:center; color:#6b7280;">Your cart is empty.</p>
  <% } %>
</div>

</body>
</html>
