<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Cart</title>
<style>
  /* Add premium palette, fonts, and base tokens */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700&display=swap');

  :root{
    --bg: #f8f6f2;        /* ivory background */
    --text: #0f0e0c;      /* carbon black */
    --muted: #6b675f;     /* warm gray */
    --card: #ffffff;      /* card */
    --accent: #c9a857;    /* metallic gold */
    --border: #e7e3dc;    /* soft border */
    --shadow: 0 10px 25px rgba(15,14,12,0.06);
    --radius: 14px;
    --radius-sm: 10px;
    --transition: 220ms cubic-bezier(.2,.8,.2,1);
  }

  * { box-sizing: border-box; }

  body {
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background-color: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 24px;
    line-height: 1.6;
  }

  h1 {
    font-family: "Playfair Display", ui-serif, Georgia, serif;
    text-align: center;
    margin: 0 0 28px;
    font-size: clamp(24px, 3.2vw, 38px);
    letter-spacing: .2px;
    color: var(--text);
  }

  .cart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 22px;
    align-items: stretch;
  }

  .cart-card {
    background-color: var(--card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition);
    will-change: transform;
  }
  .cart-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 36px rgba(15,14,12,0.08);
    border-color: color-mix(in oklab, var(--border), var(--accent) 20%);
  }

  .cart-image {
    width: 100%;
    height: 230px;
    object-fit: cover;
    background-color: #eee9df;
    display: block;
  }
  .cart-image.fallback {
    display: grid;
    place-items: center;
    color: var(--muted);
    font-weight: 600;
    letter-spacing: .3px;
  }

  .cart-details {
    padding: 16px 16px 14px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    flex-grow: 1;
  }

  .cart-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 2px;
    color: var(--text);
    letter-spacing: .2px;
  }

  .cart-style {
    font-size: 13px;
    color: var(--muted);
  }

  .price-row {
    display: flex;
    gap: 10px;
    align-items: baseline;
  }
  .price {
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
  }
  .discounted {
    font-size: 14px;
    color: var(--muted);
    text-decoration: line-through;
  }

  .total-price {
    font-weight: 700;
    color: var(--text);
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    border: 1px dashed var(--border);
    background: #fbfaf7;
  }

  .action-bar {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    gap: 8px;
  }
  .action-bar a,
  .action-bar form button {
    flex: 1;
    padding: 10px 12px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 14px;
    text-align: center;
    cursor: pointer;
    transition: transform var(--transition), background-color var(--transition), color var(--transition), border-color var(--transition), box-shadow var(--transition);
    text-decoration: none;
    outline: none;
  }
  .action-bar a:focus-visible,
  .action-bar form button:focus-visible,
  .proceed-btn:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
  }

  .view-btn {
    background-color: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }
  .view-btn:hover {
    background-color: #f5f2ec;
    border-color: color-mix(in oklab, var(--border), var(--text) 30%);
    transform: translateY(-2px);
  }

  .buy-btn {
    background-color: var(--accent);
    color: var(--text);
    border: 1px solid color-mix(in oklab, var(--accent), var(--text) 12%);
    box-shadow: 0 2px 0 color-mix(in oklab, var(--accent), var(--text) 25%) inset;
  }
  .buy-btn:hover {
    background-color: color-mix(in oklab, var(--accent), var(--text) 6%);
    transform: translateY(-2px);
  }

  .remove-btn {
    background-color: transparent;
    color: var(--muted);
    border: 1px dashed var(--border);
  }
  .remove-btn:hover {
    color: var(--text);
    background-color: #f5f2ec;
    border-style: solid;
    transform: translateY(-2px);
  }

  .proceed-container {
    text-align: center;
    margin-top: 28px;
  }
  .proceed-btn {
    background-color: var(--accent);
    color: var(--text);
    font-weight: 700;
    font-size: 16px;
    padding: 12px 24px;
    border-radius: 12px;
    text-decoration: none;
    border: 1px solid color-mix(in oklab, var(--accent), var(--text) 10%);
    transition: transform var(--transition), background-color var(--transition), box-shadow var(--transition);
    box-shadow: var(--shadow);
    display: inline-block;
  }
  .proceed-btn:hover {
    background-color: color-mix(in oklab, var(--accent), var(--text) 6%);
    transform: translateY(-3px);
  }

  .cart-grid p {
    font-size: 15px;
  }

  @media (prefers-reduced-motion: reduce) {
    .cart-card,
    .action-bar a,
    .action-bar form button,
    .proceed-btn {
      transition: none;
    }
  }

  @media (min-width: 768px) {
    body { padding: 32px; }
    .cart-image { height: 240px; }
  }
</style>
</head>
<body>
<h1>My Cart</h1>

<div class="cart-grid">
  <% if (products && products.length > 0) { %>
    <% products.forEach(product => { %>
      <div class="cart-card">
        <% if (product.image) { %>
          <img class="cart-image" src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="<%= product.name %>">
        <% } else { %>
          <div class="cart-image fallback">No Image</div>
        <% } %>

        <div class="cart-details">
          <div class="cart-name"><%= product.name %></div>
          <% if (product.styleinfo) { %>
            <div class="cart-style"><%= product.styleinfo %></div>
          <% } %>

          <div class="price-row">
            <% if (product.discount && product.discount > 0) { %>
              <span class="price"><%= product.price - product.discount %> ₹</span>
              <span class="discounted"><%= product.price %> ₹</span>
            <% } else { %>
              <span class="price"><%= product.price %> ₹</span>
            <% } %>
          </div>
          <div class="total-price">
            Total: <%= product.discount ? (product.price - product.discount) : product.price %> ₹
          </div>

          <div class="action-bar">
            <a href="/product/<%= product._id %>" class="view-btn">View More</a>
            <a href="/checkout/<%= product._id %>" class="buy-btn">Buy Now</a>
            <form method="POST" action="/users/cart/remove/<%= product._id %>">
              <button type="submit" class="remove-btn">Remove</button>
            </form>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <p style="grid-column: 1/-1; text-align:center; color:#6b7280;">Your cart is empty.</p>
  <% } %>
</div>

<% if (products && products.length > 0) { %>
  <div class="proceed-container">
    <a href="/users/buy" class="proceed-btn">Proceed to Checkout</a>
  </div>
<% } %>

</body>
</html>
